<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login - Road Monitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* [STYLES REMAIN SAME] */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; height: 100vh; display: flex; overflow: hidden; }
        .left-panel { flex: 1; background: linear-gradient(rgba(30, 41, 59, 0.85), rgba(30, 41, 59, 0.9)), url('https://images.unsplash.com/photo-1519501025264-65ba15a82390?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80'); background-size: cover; color: white; display: flex; flex-direction: column; justify-content: center; padding: 60px; }
        .left-panel h1 { font-size: 3.5rem; margin-bottom: 20px; } .left-panel h1 span { color: #ff5722; } .left-panel p { color: #cbd5e1; max-width: 500px; }
        .right-panel { flex: 1; background-color: #f8f9fa; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .card { background: white; padding: 50px; width: 100%; max-width: 420px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align: center; }
        .card h2 { margin-bottom: 10px; color: #333; } .subtitle { color: #666; font-size: 14px; margin-bottom: 30px; display: block; }
        input { width: 100%; padding: 14px; margin-bottom: 15px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 8px; outline: none; }
        button { width: 100%; padding: 14px; background: linear-gradient(45deg, #ff5722, #ff9f43); color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 10px; }
        .btn-google { background: white; color: #333; border: 1px solid #ddd; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .link { margin-top: 20px; display: block; font-size: 14px; color: #64748b; text-decoration: none; } .link span { color: #ff5722; }
        @media (max-width: 768px) { .left-panel { display: none; } }
    </style>
</head>
<body>

<div class="left-panel">
    <h1>Smart <br><span>Road Monitor</span></h1>
    <p>Join the next generation of infrastructure management.</p>
</div>

<div class="right-panel">
    <div class="card">
        <h2>Welcome Back</h2>
        <span class="subtitle">Please enter your details to sign in.</span>

        <form action="/login" method="post">
            <input type="text" name="username" placeholder="Phone Number or 'admin'" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit">Sign In</button>
            <p id="errorMsg" style="color:red; font-size:13px; margin-top:15px;"></p>
        </form>

        <button type="button" class="btn-google" onclick="signInWithGoogle()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
            Sign in (or Register) with Google
        </button>

        <a href="/register.html" class="link">Don't have an account? <span>Sign Up</span></a>
        <br><a href="/" class="link" style="font-size: 12px;">← Back to Home</a>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

    // YOUR KEYS
   // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBwn9O7IlPz8SrqDqZKow0wUuyvWYpp4_A",
  authDomain: "roadmonitor-89226.firebaseapp.com",
  projectId: "roadmonitor-89226",
  storageBucket: "roadmonitor-89226.firebasestorage.app",
  messagingSenderId: "443789467154",
  appId: "1:443789467154:web:de2212cba4c535b72382cb",
  measurementId: "G-835999L64P"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    window.signInWithGoogle = async function() {
        try {
            // 1. Popup Login
            const result = await signInWithPopup(auth, provider);
            const user = result.user;
            const token = await user.getIdToken();

            // 2. Extract Details
            const email = user.email;
            const name = user.displayName;

            // 3. Redirect to Register Page with Data
            // We encode the values to make them URL safe
            const url = `/register.html?name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&token=${encodeURIComponent(token)}`;
            window.location.href = url;

        } catch (error) {
            console.error(error);
            alert("Google Sign-In Error: " + error.message);
        }
    }

    if(window.location.search.includes("error")) {
        document.getElementById("errorMsg").innerText = "❌ Invalid Username or Password";
    }
</script>

</body>
</html>